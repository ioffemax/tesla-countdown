<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polymarket Watcher v3.2</title>
    <style>
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            user-select: none;
        }

        #container { 
            text-align: center; 
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Время обновления */
        #last-update {
            font-size: 1rem;
            color: #555;
            margin-bottom: 10px;
            font-family: monospace;
        }

        /* Главная сумма (Выплата) */
        #payout-amount {
            font-size: 18vw; /* Чуть уменьшил, чтобы влезало с отступами */
            font-weight: 800;
            line-height: 1.1; /* Увеличил, чтобы буквы не срезались */
            color: #4ade80;
            text-shadow: 0 0 40px rgba(74, 222, 128, 0.15);
            margin: 0 0 20px 0; /* Добавил отступ снизу */
            letter-spacing: -2px;
        }

        /* Пояснение под цифрой */
        .explanation {
            font-size: 1.5rem;
            color: #888;
            margin-bottom: 30px; /* Отступ до плашки со статистикой */
            font-weight: 400;
        }

        /* Технические детали */
        .stats {
            font-size: 1.1rem;
            color: #666;
            border: 1px solid #333;
            display: inline-block;
            padding: 8px 16px;
            border-radius: 50px;
            background: #111;
        }

        .stats span { color: #aaa; font-weight: bold; }

        /* Версия - сделал ярче */
        .version {
            position: fixed;
            bottom: 15px;
            right: 15px;
            font-size: 0.9rem;
            color: #666; /* Был #333, стал светлее */
            font-family: monospace;
            background: #000; /* Подложка на случай наложения */
            padding: 2px 5px;
        }

        /* Статус ошибок */
        #status {
            font-size: 1rem;
            color: #ef4444;
            margin-top: 20px;
            display: none; 
        }

        .loading { opacity: 0.5; animation: pulse 1.5s infinite ease-in-out; }
        @keyframes pulse { 0% { opacity: 0.3; } 50% { opacity: 0.7; } 100% { opacity: 0.3; } }
    </style>
</head>
<body>

    <div id="container">
        <div id="last-update">Загрузка...</div>
        
        <div id="payout-amount" class="loading">---</div>
        
        <div class="explanation">получу, если поставлю $100</div>

        <div class="stats">
            Шанс: <span id="probability">--</span>% &nbsp;|&nbsp; 
            Цена акции: <span id="share-price">--</span>¢
        </div>
        
        <div id="status"></div>
    </div>

    <div class="version">v3.2</div>

    <script>
        // --- КОНФИГУРАЦИЯ ---
        const SLUG = "russia-x-ukraine-ceasefire-in-2025";
        const MY_BET = 100; 
        
        const PROXY = "https://corsproxy.io/?";
        const API_URL = `https://gamma-api.polymarket.com/events?slug=${SLUG}`;

        async function updateData() {
            const amountEl = document.getElementById('payout-amount');
            const probEl = document.getElementById('probability');
            const priceEl = document.getElementById('share-price');
            const timeEl = document.getElementById('last-update');
            const statusEl = document.getElementById('status');

            try {
                const response = await fetch(PROXY + encodeURIComponent(API_URL));
                if (!response.ok) throw new Error("Network response was not ok");
                
                const data = await response.json();
                
                if (!data || !data.length) throw new Error("Event not found");
                const market = data[0].markets[0]; 
                
                const outcomes = JSON.parse(market.outcomes);
                const yesIndex = outcomes.indexOf("Yes");
                if (yesIndex === -1) throw new Error("No 'Yes' outcome");

                // Пытаемся получить самую точную цену
                const prices = JSON.parse(market.outcomePrices);
                let price = parseFloat(prices[yesIndex]);

                if (!price || price <= 0) throw new Error("Invalid price");

                // Расчет
                const payout = MY_BET / price;
                const priceInCents = (price * 100).toFixed(1); 
                const probability = Math.round(price * 100);

                // Вывод
                amountEl.classList.remove('loading');
                amountEl.innerText = payout.toLocaleString('en-US', {
                    style: 'currency', 
                    currency: 'USD', 
                    maximumFractionDigits: 0 
                });

                probEl.innerText = probability;
                priceEl.innerText = priceInCents;
                
                const now = new Date();
                timeEl.innerText = now.toLocaleTimeString();
                statusEl.style.display = 'none';

            } catch (err) {
                console.error(err);
                amountEl.classList.remove('loading');
                amountEl.style.color = "#444"; 
                statusEl.style.display = 'block';
                statusEl.innerText = "Ошибка: " + err.message;
            }
        }

        updateData();
        setInterval(updateData, 60000);
    </script>
</body>
</html>
