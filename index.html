<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesla Fund Tracker</title>
    <style>
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        #container { text-align: center; width: 100%; }

        /* Время */
        #last-update {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
            font-weight: 300;
        }

        /* Главная сумма */
        #payout-amount {
            font-size: 18vw; /* Максимально крупно */
            font-weight: bold;
            line-height: 1;
            color: #4ade80; /* Цвет денег */
            text-shadow: 0 0 30px rgba(74, 222, 128, 0.3);
            margin: 0;
            transition: all 0.3s ease;
        }

        /* Детали */
        .sub-text {
            font-size: 2.5rem;
            color: #888;
            margin-top: 15px;
            font-weight: 300;
        }
        
        .sub-details {
            font-size: 1.2rem;
            color: #555;
            margin-top: 5px;
        }

        /* Ошибки */
        #status {
            font-size: 1.2rem;
            color: #ef4444;
            margin-top: 30px;
            font-family: monospace;
            background: #220000;
            padding: 10px;
            border-radius: 5px;
            display: none; 
        }

        /* Анимация загрузки */
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }
        .loading { animation: pulse 1.5s infinite; color: #888 !important; text-shadow: none !important; }
    </style>
</head>
<body>

    <div id="container">
        <div id="last-update">Инициализация...</div>
        
        <div id="payout-amount" class="loading">---</div>

        <div class="sub-text">
            <span id="probability">--</span>% шанс
        </div>
        <div class="sub-details">
            Цена акции: <span id="share-price">--</span>¢
        </div>
        
        <div id="status"></div>
    </div>

    <script>
        // --- НАСТРОЙКИ ---
        const SLUG = "russia-x-ukraine-ceasefire-in-2025";
        const MY_BET = 100; // Ваша сумма ставки ($100)
        
        // Прокси для обхода блокировки CORS (чтобы работало без сервера)
        const PROXY = "https://corsproxy.io/?";
        const API_URL = `https://gamma-api.polymarket.com/events?slug=${SLUG}`;

        async function updateData() {
            const amountEl = document.getElementById('payout-amount');
            const probEl = document.getElementById('probability');
            const priceEl = document.getElementById('share-price');
            const timeEl = document.getElementById('last-update');
            const statusEl = document.getElementById('status');

            try {
                // 1. Делаем запрос через прокси
                const response = await fetch(PROXY + encodeURIComponent(API_URL));
                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                
                const data = await response.json();
                
                // 2. Парсим ответ
                if (!data || !data.length) throw new Error("Event not found");
                const market = data[0].markets[0]; // Берем первый рынок в событии
                
                // Находим индекс "Yes"
                const outcomes = JSON.parse(market.outcomes);
                const yesIndex = outcomes.indexOf("Yes");
                if (yesIndex === -1) throw new Error("'Yes' outcome not found");

                // 3. ОПРЕДЕЛЯЕМ ЦЕНУ
                // Сначала пытаемся найти 'bestAsk' (цена покупки из стакана), она точнее для расчета выигрыша.
                // Если нет, берем outcomePrices (последняя сделка).
                let rawPrice = 0;
                
                // Проверяем outcomePrices
                const prices = JSON.parse(market.outcomePrices);
                rawPrice = parseFloat(prices[yesIndex]);

                // Если API отдало 'bestAsk', можно использовать его для еще большей точности "покупки сейчас",
                // но в публичном списке событий bestAsk часто не передается.
                // Поэтому мы берем rawPrice и считаем честно.

                if (!rawPrice) throw new Error("Price is zero or invalid");

                // 4. МАТЕМАТИКА
                // Формула: (Мои $100 / Цена акции) * $1
                // Пример: $100 / 0.09 = 1111 акций = $1111 выигрыш
                const payout = MY_BET / rawPrice;
                
                // Цена в центах (например 9.2)
                const priceInCents = (rawPrice * 100).toFixed(1); 
                
                // Вероятность (округленная)
                const probability = Math.round(rawPrice * 100);

                // 5. ВЫВОД НА ЭКРАН
                amountEl.classList.remove('loading');
                
                // Форматируем сумму ($1,111)
                amountEl.innerText = payout.toLocaleString('en-US', {
                    style: 'currency', 
                    currency: 'USD', 
                    maximumFractionDigits: 0 
                });

                probEl.innerText = probability;
                priceEl.innerText = priceInCents;
                
                // Время
                const now = new Date();
                timeEl.innerText = "Обновлено: " + now.toLocaleTimeString();
                
                // Скрываем ошибки, если были
                statusEl.style.display = 'none';

            } catch (err) {
                console.error(err);
                amountEl.classList.remove('loading');
                amountEl.style.color = "#666"; // Серый цвет при ошибке
                statusEl.style.display = 'block';
                statusEl.innerText = "ОШИБКА: " + err.message + "\n(Проверьте интернет или попробуйте позже)";
            }
        }

        // Запускаем сразу и потом каждую минуту
        updateData();
        setInterval(updateData, 60000);
    </script>
</body>
</html>
