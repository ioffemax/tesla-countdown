<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesla Fund Tracker v3.1</title>
    <style>
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            user-select: none; /* Чтобы красиво смотрелось без выделения текста */
        }

        #container { text-align: center; width: 100%; }

        /* Время обновления */
        #last-update {
            font-size: 1rem;
            color: #444;
            margin-bottom: 20px;
            font-family: monospace;
        }

        /* Главная сумма (Выплата) */
        #payout-amount {
            font-size: 20vw; /* Адаптивный огромный размер */
            font-weight: 800;
            line-height: 0.9;
            color: #4ade80; /* Зеленый */
            text-shadow: 0 0 40px rgba(74, 222, 128, 0.15);
            margin: 0;
            letter-spacing: -2px;
        }

        /* Пояснение под цифрой */
        .explanation {
            font-size: 1.5rem;
            color: #666;
            margin-top: 10px;
            font-weight: 400;
        }

        /* Технические детали (шанс и цена) */
        .stats {
            margin-top: 30px;
            font-size: 1.2rem;
            color: #444;
            border: 1px solid #222;
            display: inline-block;
            padding: 10px 20px;
            border-radius: 50px;
            background: #0a0a0a;
        }

        .stats span { color: #888; font-weight: bold; }

        /* Версия */
        .version {
            position: fixed;
            bottom: 15px;
            right: 15px;
            font-size: 0.8rem;
            color: #333;
            font-family: monospace;
        }

        /* Статус ошибок */
        #status {
            font-size: 1rem;
            color: #ef4444;
            margin-top: 20px;
            display: none; 
        }

        /* Анимация загрузки */
        .loading { opacity: 0.5; animation: pulse 1.5s infinite ease-in-out; }
        @keyframes pulse { 0% { opacity: 0.3; } 50% { opacity: 0.7; } 100% { opacity: 0.3; } }
    </style>
</head>
<body>

    <div id="container">
        <div id="last-update">Загрузка данных...</div>
        
        <div id="payout-amount" class="loading">---</div>
        
        <div class="explanation">получу, если поставлю $100</div>

        <div class="stats">
            Шанс: <span id="probability">--</span>% &nbsp;|&nbsp; 
            Цена акции: <span id="share-price">--</span>¢
        </div>
        
        <div id="status"></div>
    </div>

    <div class="version">v3.1</div>

    <script>
        // --- КОНФИГУРАЦИЯ ---
        const SLUG = "russia-x-ukraine-ceasefire-in-2025";
        const MY_BET = 100; // Расчет для ставки $100
        
        // Прокси
        const PROXY = "https://corsproxy.io/?";
        const API_URL = `https://gamma-api.polymarket.com/events?slug=${SLUG}`;

        async function updateData() {
            const amountEl = document.getElementById('payout-amount');
            const probEl = document.getElementById('probability');
            const priceEl = document.getElementById('share-price');
            const timeEl = document.getElementById('last-update');
            const statusEl = document.getElementById('status');

            try {
                // Запрос
                const response = await fetch(PROXY + encodeURIComponent(API_URL));
                if (!response.ok) throw new Error("Network response was not ok");
                
                const data = await response.json();
                
                // Парсинг
                if (!data || !data.length) throw new Error("Event not found");
                const market = data[0].markets[0]; 
                
                // Ищем "Yes"
                const outcomes = JSON.parse(market.outcomes);
                const yesIndex = outcomes.indexOf("Yes");
                if (yesIndex === -1) throw new Error("No 'Yes' outcome");

                // Ищем цену
                const prices = JSON.parse(market.outcomePrices);
                let price = parseFloat(prices[yesIndex]);

                if (!price || price <= 0) throw new Error("Invalid price");

                // --- РАСЧЕТ ВЫПЛАТЫ ---
                // Формула: (Ставка / Цена) * 1
                const payout = MY_BET / price;
                
                // Детали для отображения
                const priceInCents = (price * 100).toFixed(1); 
                const probability = Math.round(price * 100);

                // --- ОБНОВЛЕНИЕ UI ---
                amountEl.classList.remove('loading');
                
                // Отображаем сумму без копеек для чистоты (maximumFractionDigits: 0)
                amountEl.innerText = payout.toLocaleString('en-US', {
                    style: 'currency', 
                    currency: 'USD', 
                    maximumFractionDigits: 0 
                });

                probEl.innerText = probability;
                priceEl.innerText = priceInCents;
                
                const now = new Date();
                timeEl.innerText = now.toLocaleTimeString(); // Только время
                statusEl.style.display = 'none';

            } catch (err) {
                console.error(err);
                amountEl.classList.remove('loading');
                amountEl.style.color = "#444"; 
                statusEl.style.display = 'block';
                statusEl.innerText = "Ошибка: " + err.message;
            }
        }

        updateData();
        setInterval(updateData, 60000); // Обновление раз в минуту
    </script>
</body>
</html>
