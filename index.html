<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Перемирие 2025 · $100 → $1,428</title>
<style>
  body{margin:0;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#000;color:#fff;font-family:system-ui,sans-serif;text-align:center;}
  .big{font-size:19vw;font-weight:900;color:#00ff9d;letter-spacing:-6px;text-shadow:0 0 50px #00ff9d30;}
  .sub{font-size:4.5vw;margin:30px 0 50px;color:#aaa;}
  .box{background:#111;border:1px solid #333;padding:18px 35px;border-radius:18px;min-width:160px;}
  .val{font-size:5.5vw;font-weight:bold;}
  .lbl{font-size:2.2vw;color:#666;text-transform:uppercase;letter-spacing:1.2px;margin-top:6px;}
  .time{position:fixed;top:16px;font-size:2.8vw;color:#555;}
</style>
</head>
<body>

<div class="time" id="t">Загрузка...</div>
<div class="big" id="win">—</div>
<div class="sub">получу, если куплю "Yes" на $100</div>
<div style="display:flex;gap:50px;">
  <div class="box"><div class="val" id="cents">—</div><div class="lbl">цена yes</div></div>
  <div class="box"><div class="val" id="prob">—</div><div class="lbl">шанс перемирия</div></div>
</div>

<script>
const SLUG = "russia-x-ukraine-ceasefire-in-2025";
const FALLBACK_PRICE = 0.07; // Твои реальные 7¢

async function fetchFresh() {
  const url = `https://gamma-api.polymarket.com/events?slug=${SLUG}&_t=${Date.now()}`;
  const resp = await fetch(url, {
    headers: { 'Cache-Control': 'no-cache', 'Pragma': 'no-cache' }
  });
  if (!resp.ok) throw new Error('HTTP ' + resp.status);
  return await resp.json();
}

async function update(retry = 0) {
  let yesPrice = FALLBACK_PRICE;
  
  try {
    const events = await fetchFresh();
    if (events && events[0] && events[0].markets && events[0].markets[0]) {
      const market = events[0].markets[0];
      const outcomes = JSON.parse(market.outcomes || '["Yes", "No"]');
      const yesIndex = outcomes.indexOf("Yes");
      if (yesIndex !== -1) {
        const prices = JSON.parse(market.outcomePrices || '[0.07, 0.93]');
        yesPrice = parseFloat(prices[yesIndex]);
      }
    }
    if (!yesPrice || yesPrice <= 0 || yesPrice >= 1) yesPrice = FALLBACK_PRICE;
  } catch(e) {
    console.warn("Попытка " + (retry + 1) + " провалилась:", e);
    if (retry < 2) { // Retry до 3 раз
      await new Promise(r => setTimeout(r, 2000)); // Пауза 2 сек
      return update(retry + 1);
    }
    yesPrice = FALLBACK_PRICE; // Fallback на 7¢
  }

  const payout = Math.round(100 / yesPrice);
  const cents  = (yesPrice * 100).toFixed(0) + "¢";
  const chance = Math.round(yesPrice * 100) + "%";

  document.getElementById("win").textContent   = "$" + payout.toLocaleString("ru-RU");
  document.getElementById("cents").textContent = cents;
  document.getElementById("prob").textContent  = chance;
  
  document.getElementById("t").textContent = 
    "Обновлено: " + new Date().toLocaleTimeString("ru-RU");
}

update();
setInterval(update, 60000);
</script>
</body>
</html>
